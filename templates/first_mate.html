<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>First Mate â€“ Captain Sonar</title>
  <link rel="stylesheet" href="/static/css/base.css"/>
  <link rel="stylesheet" href="/static/css/first_mate.css"/>
</head>
<body class="role-first_mate team-{{ team }}">
<div id="charge-overlay" class="lock-overlay hidden">
  <p>Waiting for captain to moveâ€¦</p>
</div>
<div id="result-toast" class="result-toast hidden"></div>

<!-- Sonar modal (RULEBOOK: FM activates, then enemy captain must respond with 1 true + 1 false) -->
<div id="sonar-modal" class="modal hidden">
  <div class="modal-card">
    <h3>ðŸ“¡ Sonar Ping</h3>
    <p>Activate sonar â€” the <strong>enemy captain</strong> will be asked to reveal 2 pieces of info (1 true, 1 false, different types).</p>
    <p style="font-size:.8rem;color:var(--text-muted);">You will receive their stated row/column/sector â€” use your radio operator map to deduce which is true!</p>
    <div class="modal-btns">
      <button class="btn-cancel"  onclick="closeSonar()">Cancel</button>
      <button class="btn-confirm" onclick="submitSonar()">ðŸ“¡ Activate Sonar!</button>
    </div>
  </div>
</div>

<!-- Drone modal -->
<div id="drone-modal" class="modal hidden">
  <div class="modal-card">
    <h3>ðŸ›¸ Drone Scan</h3>
    <p>Click the sector you think the enemy is in:</p>
    <canvas id="drone-map-canvas"></canvas>
    <div class="modal-btns"><button class="btn-cancel" onclick="closeDrone()">Cancel</button></div>
  </div>
</div>

<div class="app-layout">
  <div class="ctrl-panel full-width">
    <div class="role-header team-{{ team }}">
      <span class="role-title">âš™ FIRST MATE</span>
      <span class="team-badge">{{ team | upper }} TEAM</span>
    </div>

    <!-- Health (own only) -->
    <div class="panel-section">
      <div class="section-label">OWN HEALTH</div>
      <div class="health-row fixed-health" id="own-health"></div>
    </div>

    <div class="section-label" style="margin:.6rem 1rem .3rem">
      SYSTEMS â€” charge one per turn Â· activate green systems after captain moves
    </div>

    <!-- Systems panel -->
    <div class="systems-panel" id="systems-panel">
      <!-- Injected by JS -->
    </div>

    <!-- Event log -->
    <div class="panel-section flex-grow">
      <div class="section-label">EVENT LOG</div>
      <div class="event-log" id="event-log"></div>
    </div>
  </div>
</div>

<script>
  const GAME_ID   = "{{ game_id }}";
  const MY_NAME   = "{{ player_name }}";
  const MY_TEAM   = "{{ team }}";
  const MAP_ROWS  = {{ map_rows }};
  const MAP_COLS  = {{ map_cols }};
  const SECTOR_SZ = {{ sector_size }};
  const ISLANDS   = {{ islands | tojson }};
  const COL_LABELS= {{ col_labels | tojson }};
</script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="/static/js/first_mate.js"></script>
</body>
</html>
